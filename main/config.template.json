{
  "log": {
    "disabled": false,
    "level": "fatal",
    "timestamp": true
  },
  "experimental": {
    "clash_api": {
      "external_controller": "127.0.0.1:9090",
      "external_ui": "zashboard",
      "external_ui_download_url": "https://github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip",
      "external_ui_download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
      "secret": "${CLASH_API_SECRET}",
      "default_mode": "rule"
    },
    "cache_file": {
      "enabled": true,
      "store_rdrc": true,
      "store_fakeip": false
    }
  },
  "dns": {
    "servers": [
      {
        "tag": "google",
        "type": "https",
        "server": "8.8.4.4",
        "detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "strategy": "ipv4_only"
      },
      {
        "tag": "local",
        "type": "https",
        "server": "223.5.5.5",
        "strategy": "ipv4_only"
      },
      {
        "tag": "fcm_hosts",
        "type": "hosts",
        "path": "/etc/sing-box/fcm.hosts"
      }
    ],
    "rules": [
      // 1. å¹¿å‘Šæ‹¦æˆª
      {
        "rule_set": ["geosite-category-ads-all"],
        "action": "reject"
      },
      // 2. Clash Direct æ¨¡å¼
      {
        "clash_mode": "Direct",
        "server": "local"
      },
      // 3. FCM ä¸“é¡¹: å¼ºåˆ¶ä»æœ¬åœ° hosts æ–‡ä»¶è§£æ
      {
        "rule_set": "geosite-googlefcm",
        "server": "fcm_hosts",
        "disable_cache": true
      },
      // 4. Clash Global æ¨¡å¼
      {
        "clash_mode": "Global",
        "query_type": ["A"],
        "server": "google",
        "strategy": "ipv4_only"
      },
      // 5. Steam CN åŸŸå â†’ local (Real-IPï¼Œç¡®ä¿ IPCountry: CN)
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          {
            "domain": [
              "cm.steampowered.com",
              "steamserver.net",
              "steamcontent.com",
              "steamstatic.com"
            ]
          },
          { "rule_set": "geosite-steam@cn" }
        ],
        "server": "local"
      },
      // 6. CN åŸŸå (å•å±‚) â†’ local
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          {
            "domain": [
              "beautifulcarrot.com",
              "0xc.xyz",
              "0xc.cn",
              "ash.do",
              "ash6.com",
              "dl.google.com"
            ],
            "domain_suffix": [
              "youtune.tech"
            ]
          },
          {
            "rule_set": [
              "geosite-cn",
              "geosite-microsoft@cn",
              "geosite-google@cn",
              "geosite-googlefcm"
            ]
          }
        ],
        "server": "local"
      },
      // 7. Google Play åŒºåŸŸä¿®å¤åŸŸå â†’ google (èµ°ä»£ç† DNS)
      {
        "domain": [
          "services.googleapis.cn",
          "googleapis.cn",
          "xn--ngstr-lra8j.com",
          "xn--ngstr-cn-8za9o.com"
        ],
        "server": "google"
      },
      // 8. å¤–å›½åŸŸå â†’ google
      {
        "rule_set": ["geosite-geolocation-!cn"],
        "server": "google",
        "strategy": "ipv4_only"
      }
    ],
    "final": "google",
    "strategy": "ipv4_only",
    "independent_cache": true,
    "reverse_mapping": true
  },
  "inbounds": [
    {
      "type": "tun",
      "tag": "tun-in",
      "stack": "mixed",
      "address": ["172.19.0.1/30"],
      "auto_route": true,
      "auto_redirect": true,
      "strict_route": false,
      "mtu": 9000,
      "route_exclude_address": [
        "173.73.48.0/24",
        "10.42.0.0/24"
      ],
      "route_exclude_address_set": ["geoip-cn"]
    },
    {
      "type": "mixed",
      "listen": "0.0.0.0",
      "listen_port": 7890,
      "users": [
        {
          "username": "${MIXED_PROXY_USERNAME}",
          "password": "${MIXED_PROXY_PASSWORD}"
        }
      ]
    },
    {
      "type": "mixed",
      "listen": "127.0.0.1",
      "listen_port": 7891
    },
    {
      "type": "direct",
      "tag": "dns-in",
      "network": "udp",
      "listen": "127.0.0.1",
      "listen_port": 6053
    }
  ],
  "providers": [
    {
      "tag": "${PROVIDER_NAME_1}",
      "type": "remote",
      "url": "${SUB_URL_1}",
      "path": "./provider_1_cache.yaml",
      "update_interval": "12h",
      "user_agent": "clash.meta",
      "download_detour": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿",
      "health_check": {
        "enabled": false
      }
    },
    {
      "tag": "${PROVIDER_NAME_2}",
      "type": "remote",
      "url": "${SUB_URL_2}",
      "path": "./provider_2_cache.yaml",
      "update_interval": "12h",
      "user_agent": "clash.meta",
      "download_detour": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿",
      "health_check": {
        "enabled": false
      }
    },
    {
      "tag": "${PROVIDER_NAME_3}",
      "type": "remote",
      "url": "${SUB_URL_3}",
      "path": "./provider_3_cache.yaml",
      "update_interval": "12h",
      "user_agent": "clash.meta",
      "download_detour": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿",
      "health_check": {
        "enabled": false
      }
    }
  ],
  "outbounds": [
    {
      "tag": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
      "type": "selector",
      "outbounds": [
        "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰",
        "âš¡ ç”µä¿¡ä¼˜é€‰",
        "ğŸ‡¯ğŸ‡µ å¤§é˜ªè½¯é“¶",
        "ğŸ“¦ å¤§æµé‡",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©1",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©2",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©3",
        "ğŸ“² ç”µæŠ¥æ¶ˆæ¯",
        "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      ],
      "default": "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰"
    },
    {
      "tag": "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰",
      "type": "urltest",
      "providers": [
        "${PROVIDER_NAME_1}",
        "${PROVIDER_NAME_2}",
        "${PROVIDER_NAME_3}"
      ],
      "include": "(?i)s[12]\\b",
      "url": "http://connectivitycheck.gstatic.com/generate_204",
      "tolerance": 50,
      "interval": "3m",
      "idle_timeout": "30m",
      "interrupt_exist_connections": false
    },
    {
      "tag": "âš¡ ç”µä¿¡ä¼˜é€‰",
      "type": "urltest",
      "providers": [
        "${PROVIDER_NAME_1}",
        "${PROVIDER_NAME_2}",
        "${PROVIDER_NAME_3}"
      ],
      "include": "(?i)s[35]\\b",
      "url": "http://connectivitycheck.gstatic.com/generate_204",
      "tolerance": 50,
      "interval": "3m",
      "idle_timeout": "30m",
      "interrupt_exist_connections": false
    },
    {
      "tag": "ğŸ‡¯ğŸ‡µ å¤§é˜ªè½¯é“¶",
      "type": "urltest",
      "providers": [
        "${PROVIDER_NAME_1}",
        "${PROVIDER_NAME_2}",
        "${PROVIDER_NAME_3}"
      ],
      "include": "(?i)s4\\b",
      "url": "http://connectivitycheck.gstatic.com/generate_204",
      "tolerance": 50,
      "interval": "3m",
      "idle_timeout": "30m",
      "interrupt_exist_connections": false
    },
    {
      "tag": "ğŸ“¦ å¤§æµé‡",
      "type": "selector",
      "providers": [
        "${PROVIDER_NAME_1}",
        "${PROVIDER_NAME_2}",
        "${PROVIDER_NAME_3}"
      ],
      "include": "(?i)s801\\b"
    },
    {
      "tag": "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©1",
      "type": "selector",
      "providers": [
        "${PROVIDER_NAME_1}",
        "${PROVIDER_NAME_2}",
        "${PROVIDER_NAME_3}"
      ],
      "use_all_providers": true
    },
    {
      "tag": "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©2",
      "type": "selector",
      "providers": [
        "${PROVIDER_NAME_1}",
        "${PROVIDER_NAME_2}",
        "${PROVIDER_NAME_3}"
      ],
      "use_all_providers": true
    },
    {
      "tag": "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©3",
      "type": "selector",
      "providers": [
        "${PROVIDER_NAME_1}",
        "${PROVIDER_NAME_2}",
        "${PROVIDER_NAME_3}"
      ],
      "use_all_providers": true
    },
    {
      "tag": "ğŸ“² ç”µæŠ¥æ¶ˆæ¯",
      "type": "selector",
      "outbounds": [
        "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰",
        "âš¡ ç”µä¿¡ä¼˜é€‰",
        "ğŸ‡¯ğŸ‡µ å¤§é˜ªè½¯é“¶",
        "ğŸ“¦ å¤§æµé‡",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©1",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©2",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©3",
        "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      ],
      "default": "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰"
    },
    {
      "tag": "ğŸ” 18comic",
      "type": "selector",
      "outbounds": [
        "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰",
        "âš¡ ç”µä¿¡ä¼˜é€‰",
        "ğŸ‡¯ğŸ‡µ å¤§é˜ªè½¯é“¶",
        "ğŸ“¦ å¤§æµé‡",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©1",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©2",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©3",
        "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      ],
      "default": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©"
    },
    {
      "tag": "ğŸ® dlsite",
      "type": "selector",
      "outbounds": [
        "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰",
        "âš¡ ç”µä¿¡ä¼˜é€‰",
        "ğŸ‡¯ğŸ‡µ å¤§é˜ªè½¯é“¶",
        "ğŸ“¦ å¤§æµé‡",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©1",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©2",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©3",
        "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      ],
      "default": "ğŸ‡¯ğŸ‡µ å¤§é˜ªè½¯é“¶"
    },
    {
      "tag": "ğŸ® Steamå•†åº—",
      "type": "selector",
      "outbounds": [
        "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "âš¡ è”é€šç§»åŠ¨ä¼˜é€‰",
        "âš¡ ç”µä¿¡ä¼˜é€‰",
        "ğŸ‡¯ğŸ‡µ å¤§é˜ªè½¯é“¶",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©1",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©2",
        "ğŸŒ€ æ‰‹åŠ¨é€‰æ‹©3",
        "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      ]
    },
    {
      "tag": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿",
      "type": "direct"
    }
  ],
  "route": {
    "auto_detect_interface": true,
    "default_domain_resolver": "local",
    "final": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
    "rules": [
      // 1. åè®®å—…æ¢
      { "action": "sniff" },
      // 2. DNS åŠ«æŒ
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          { "protocol": "dns" },
          { "port": 53 },
          { "inbound": ["dns-in"] }
        ],
        "action": "hijack-dns"
      },
      // 3. ç§æœ‰åœ°å€/LAN/NTP/BitTorrent ç›´è¿
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          { "ip_is_private": true },
          { "protocol": ["ntp", "bittorrent"] },
          { "port": 123 },
          { "domain_suffix": [".lan"] }
        ],
        "outbound": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      },
      // 4. Clash æ¨¡å¼è¦†ç›–
      {
        "clash_mode": "Direct",
        "outbound": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      },
      {
        "clash_mode": "Global",
        "outbound": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©"
      },
      // 5. å¹¿å‘Šæ‹¦æˆª
      {
        "rule_set": ["geosite-category-ads-all"],
        "action": "reject"
      },
      // 6. åè®®å°é” (DoT/QUIC/STUN)
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          { "port": 853 },
          { "network": "udp", "port": 443 },
          { "protocol": ["stun", "quic"] }
        ],
        "action": "reject"
      },
      // 7. Steam CDN/ä¸‹è½½ â†’ ç›´è¿ (Dogfight360 æ–¹æ¡ˆ)
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          {
            "domain_suffix": [
              "cm.steampowered.com",
              "steamserver.net",
              "steamcontent.com"
            ]
          },
          { "rule_set": "geosite-steam@cn" },
          {
            "ip_cidr": [
              "45.121.184.0/24",
              "103.10.124.0/23",
              "103.28.54.0/24",
              "146.66.152.0/24",
              "146.66.155.0/24",
              "153.254.86.0/24",
              "155.133.224.0/22",
              "155.133.230.0/24",
              "155.133.232.0/23",
              "155.133.234.0/24",
              "155.133.236.0/22",
              "155.133.240.0/23",
              "155.133.244.0/23",
              "155.133.246.0/24",
              "155.133.248.0/21",
              "162.254.192.0/21",
              "185.25.182.0/23",
              "190.217.32.0/22",
              "192.69.96.0/22",
              "205.196.6.0/24",
              "208.64.200.0/22",
              "208.78.164.0/22",
              "205.185.194.0/24"
            ]
          }
        ],
        "outbound": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      },
      // 8. Steam å•†åº—/ç¤¾åŒº â†’ ä»£ç†
      { "rule_set": "geosite-steam", "outbound": "ğŸ® Steamå•†åº—" },
      // 9. Telegram ç”µæŠ¥ â†’ ä»£ç†
      { "rule_set": ["geoip-telegram", "geosite-telegram"], "outbound": "ğŸ“² ç”µæŠ¥æ¶ˆæ¯" },
      // 10. 18comic æˆäººæ¼«ç”» â†’ ä»£ç†
      {
        "domain_suffix": [
          "18comic.com",
          "18comic.vip",
          "18comic2.com",
          "buka18.com"
        ],
        "outbound": "ğŸ” 18comic"
      },
      // 11. dlsite æ—¥æœ¬åŒäºº â†’ ä»£ç†
      {
        "domain_suffix": [
          "dlsite.com",
          "dlsite.jp"
        ],
        "outbound": "ğŸ® dlsite"
      },
      // 11. Google Play åŒºåŸŸä¿®å¤ â†’ ä»£ç†
      {
        "domain": [
          "googleapis.cn",
          "services.googleapis.cn",
          "xn--ngstr-lra8j.com",
          "xn--ngstr-cn-8za9o.com"
        ],
        "rule_set": ["geosite-google-play@cn"],
        "outbound": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©"
      },
      // 10. CN åŸŸåç›´è¿ (å•å±‚)
      {
        "rule_set": [
          "geosite-cn",
          "geosite-category-games@cn",
          "geosite-microsoft@cn",
          "geosite-google@cn",
          "geosite-googlefcm"
        ],
        "domain": [
          "beautifulcarrot.com",
          "0xc.xyz",
          "0xc.cn",
          "ash.do",
          "ash6.com",
          "dl.google.com"
        ],
        "domain_suffix": [
          "youtune.tech"
        ],
        "outbound": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      },
      // 11. è¿›ç¨‹ç™½åå• â†’ ç›´è¿ (ä»… Linuxï¼Œå»æ‰ .exe)
      {
        "process_name": [
          // è…¾è®¯ç³»
          "wechat",
          "WeChat",
          "linuxqq",
          "wxwork",
          // ç”Ÿäº§åŠ›å·¥å…·
          "dingtalk",
          "feishu",
          "netease-cloud-music",
          "qqmusic",
          "bilibili",
          "wemeetapp",
          // åŠå…¬ä¸ç½‘ç›˜
          "wps",
          "baidunetdisk",
          "aliyunpan",
          "Quark",
          "wegame",
          // å±€åŸŸç½‘å‘ç°ä¸åŒæ­¥
          "kdeconnectd",
          "kdeconnect-app",
          "localsend_app",
          "anydesk",
          "rustdesk",
          // è¿œæ§ä¸ä¸²æµ
          "moonlight",
          "remmina",
          "vncviewer",
          // å…¶ä»–
          "UniVPN"
        ],
        "outbound": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿"
      },
      // 12. å¤–å›½åŸŸå â†’ ä»£ç†
      { "rule_set": "geosite-geolocation-!cn", "outbound": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©" },
      // 13. GeoIP CN å…œåº• â†’ ç›´è¿
      { "rule_set": "geoip-cn", "outbound": "ğŸ‡¨ğŸ‡³ å›½å†…ç›´è¿" }
      // 14. final â†’ ğŸ”° èŠ‚ç‚¹é€‰æ‹© (åœ¨ route.final ä¸­å®šä¹‰)
    ],
    "rule_set": [
      {
        "tag": "geosite-cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geoip-cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geoip/cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geosite-geolocation-!cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/geolocation-!cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geosite-steam@cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/steam@cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geosite-steam",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/steam.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geosite-google@cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/google@cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©"
      },
      {
        "tag": "geosite-google-play@cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/google-play@cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©"
      },
      {
        "tag": "geosite-googlefcm",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/googlefcm.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©"
      },
      {
        "tag": "geosite-category-ads-all",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/category-ads-all.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geosite-category-games@cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/category-games@cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geosite-microsoft@cn",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/microsoft@cn.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geoip-telegram",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geoip/telegram.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      },
      {
        "tag": "geosite-telegram",
        "type": "remote",
        "format": "binary",
        "url": "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/sing/geo/geosite/telegram.srs",
        "download_detour": "ğŸ”° èŠ‚ç‚¹é€‰æ‹©",
        "update_interval": "3d"
      }
    ]
  }
}
